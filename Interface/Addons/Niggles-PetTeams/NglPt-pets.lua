-------------------------------------------------------------------------------
--                 L  O  C  A  L     V  A  R  I  A  B  L  E  S
-------------------------------------------------------------------------------

local addonName, L = ...;

local cpjGetPetStats       = C_PetJournal.GetPetStats;
local cpjGetPetInfoByPetID = C_PetJournal.GetPetInfoByPetID;
local floor                = math.floor;
local bitAnd               = bit.band;

local petBreeds =
{
  [0x00000100] = "(B/B)", --  3/13
  [0x00000200] = "(P/P)", --  4/14
  [0x00000400] = "(S/S)", --  5/15
  [0x00000800] = "(H/H)", --  6/16
  [0x00001000] = "(H/P)", --  7/17
  [0x00002000] = "(P/S)", --  8/18
  [0x00004000] = "(H/S)", --  9/19
  [0x00008000] = "(P/B)", -- 10/20
  [0x00010000] = "(S/B)", -- 11/21
  [0x00020000] = "(H/B)", -- 12/22
};

local baseStatProfiles =
{
  {8.5,7.5,8},{7,8.5,8.5},{6.5,9,8.5},{7,9,8},{7.5,7.5,9},{8,7.5,8.5},{9,7,8},
  {9,8,7},{8.5,8,7.5},{8,8,8},{8.5,7,8.5},{8.5,9,6.5},{8,7,9},{7.5,8.5,8},
  {8,8.5,7.5},{7,7,10},{8.5,8.5,7},{8,8.005,8},{7.5,8,8.5},{7.5,7,9.5},
  {9,7.5,7.5},{9,9,6},{7.5,9,7.5},{8,9,7},{9.5,8,6.5},{9.5,8.5,6},{8,9.5,6.5},
  {8,8.75,7.25},{7.75,8.5,7.75},{7,8,9},{9,6.5,8.5},{6,8,10},{8,6.5,9.5},
  {9,8.5,6.5},{9.5,7.5,7},{6.5,8,9.5},{6.75,10.5,6.75},{7.5,8.25,8.25},
  {8.25,8,7.75},{8,8.25,7.75},{7.75,8,8.25},{8.25,8.25,7.5},{7.75,8.25,8},
  {8.25,8.5,7.25},{8.3,7.9,7.8},{8.125,6.875,9},{13,8,5.5},{7.625,7.875,8.5},
  {7.625,8.25,8.125},{7.75,7.75,8.5},{9.75,7.25,7},{7.5,9.5,7},{6.75,9.25,8},
  {8.75,8,7.25},{8.5,8.75,6.75},{7.25,8.75,8},{7.625,8.375,8},
  {9.5,8.5,-1.375},{8.25,7.75,8},{8,7.75,8.25},{9,7.625,7.375},
  {8.75,7.75,7.5},{7.625,8,8.375},{8.5,8.25,7.25},{8,9.25,6.75},
  {7.75,8.125,8.125},{8.25,8.5,8.5},{8.75,7.875,7.375},{7.75,7.5,8.75},
  {8.75,7.625,7.625},{8,7.25,8.75},{7.625,7.75,8.625},{7.5,8.75,7.75},
  {7.625,7.625,8.75},{7.25,8.375,8.375},{7.625,8.75,7.625},{8.25,7.25,8.5},
  {6.5,8.75,8.75},{8.375,8.375,7.25},{7.875,8.25,7.875},{8.165,8.165,7.67},
  {7.5,8.125,8.375},{8,7.625,8.375},{8.125,7.875,8},{8.625,8.375,7},
  {8.625,8.625,6.75},{7.75,8.375,7.875},{8.125,8.125,7.75},{7.75,7.875,8.375},
  {8.375,8,7.625},{7.875,7.625,8.5},{8.125,7.75,8.125},{7.5,8.375,8.125},
  {7.875,7.875,8.25},{8.25,7.875,7.875},{8,7.875,8.125},{7.875,8,8.125},
  {8.375,7.875,7.75},{7.875,7.75,8.375},{8.25,7.625,8.125},{8.375,8.125,7.5},
  {8.125,8.375,7.5},{7.625,8.625,7.75},{8.625,7.75,7.625},{7.75,8.75,7.5},
  {7.75,8.625,7.625},{8.375,7.625,8},{7.375,8.625,8},{7.625,8.875,7.5},
  {7.25,8.25,8.5},{9.5,7.25,7.25},{7.25,7.25,9.5},{8.25,9,6.75},{7.25,7,9.75},
  {7.25,9.75,7},{10.5,6.25,7.25},{6.75,8.625,8.625},{9.125,8.375,6.5},
  {9.125,6.25,8.625},{8,8.1,7.9},{8.15,8.15,7.7},{8.9,8,7.1},{7.25,8.45,8.3},
  {7.1,8.7,8.2},{7.775,7.775,8.45},{7.4,8.3,8.3},{7.1,8.45,8.45},{8.6,8,7.4},
  {6.5,8.9,8.6},{8.2,8,7.8},{8.1,8,7.9},{8.125,8,7.875},{7.825,8,8.175},
  {7.9,8.05,8.05},{7.85,7.85,8.3},{8.3,7.7,8},{7.825,8.175,8},{7.6,8.4,8},
  {7.8,8.2,8},{8.5,7.25,8.25},{8.225,7.7,8.075},{7.55,8.9,7.55},
  {7.5,8.875,7.625},{7.725,8.275,8},{7.25,7.875,8.875},{8.875,7.625,7.5},
  {7.8,8.1,8.1},{8.875,8,7.125},{7.5,8.83,7.67},{7.505,8.33,8.165},
  {7.325,8.175,8.5},{8.075,8.325,7.6},{8.15,7.925,7.925},{7.55,8.3,8.15},
  {8.275,8.175,7.55},{8.25,8.125,7.625},{8.15,8.05,7.8},{7.85,7.95,8.2},
  {8.325,8.175,7.5},{9.125,8.125,6.75},{8,8.875,7.125},{8.675,8,7.325},
  {8.425,8,7.575},{7.875,8.325,7.8},{6.75,8,9.25},{8.15,8,7.85},{7.85,8,8.15},
  {8.075,8,7.925},{8.05,8.05,7.9},{8.45,7.925,7.625},{8.6,7.85,7.55},
  {8.175,8.275,7.55},{7.125,8.375,8.5},{6.75,7.5,9.75},{6.75,8.75,8.5},
  {6.375,9.125,8.5},{7.125,8.25,8.625},{8.375,8.25,7.375},{9.125,7.5,7.375},
  {7.125,9.175,7.7},{9.625,7.125,7.25},{10.25,6.875,6.875},{7.325,8.45,8.225},
  {8.15,7.575,8.275},{7.25,9.25,7.5},{8.725,8.275,7},{7.25,9,7.75},
  {7.825,8.675,7.5},{8.725,8.775,6.5},{7.875,8.675,7.45},{8.575,8.425,7},
  {8.575,7.575,7.85},{7.25,8.925,7.825},{9.725,8.275,6},{7.225,9.775,7},
  {8.75,7.375,7.875},{5.75,9.125,9.125},{6.875,9.125,8},{7.5,8.575,7.925},
  {7.125,9.625,7.25},{8,9.125,6.875},{10.275,7,6.725},{7.375,9.125,7.5},
  {6.75,9.625,7.625},{6.75,9.125,8.125},{6.75,8.275,8.975},
};

local speciesInfo =
{
  [39]=65537,[40]=8194,[41]=514,[42]=4099,[43]=260,[44]=1026,[45]=258,
  [46]=131077,[47]=1542,[49]=263,[50]=65544,[51]=1289,[52]=229642,[55]=19723,
  [56]=8204,[57]=513,[58]=8196,[59]=16393,[64]=16385,[65]=131073,[67]=41226,
  [68]=6410,[69]=98565,[70]=132358,[72]=66829,[74]=65541,[75]=1038,[77]=266,
  [78]=131086,[83]=8193,[84]=229642,[85]=16385,[86]=4097,[87]=1039,[89]=2058,
  [90]=4098,[92]=266,[93]=515,[94]=1040,[95]=266,[106]=32769,[107]=266,
  [111]=131082,[114]=131089,[115]=266,[116]=131082,[117]=266,[118]=266,
  [119]=266,[120]=266,[121]=266,[122]=1042,[124]=266,[125]=1034,[126]=32778,
  [127]=4102,[128]=266,[130]=266,[131]=8198,[132]=2056,[136]=168202,
  [137]=66829,[138]=131329,[139]=139534,[140]=131855,[141]=133381,[142]=1295,
  [143]=9486,[144]=66821,[145]=11521,[146]=148755,[149]=16404,[153]=4106,
  [155]=4106,[156]=266,[157]=266,[158]=266,[159]=2058,[160]=522,[162]=32783,
  [163]=8207,[164]=271,[165]=16385,[166]=4113,[167]=18709,[168]=1025,
  [169]=1290,[170]=4106,[171]=4106,[172]=32782,[173]=4111,[174]=271,
  [175]=1038,[179]=4105,[180]=4105,[183]=266,[186]=9998,[187]=8209,[188]=2065,
  [189]=266,[190]=137233,[191]=257,[192]=16394,[193]=527,[194]=91402,
  [195]=91141,[196]=4105,[197]=8211,[198]=65546,[199]=32778,[200]=1037,
  [201]=4106,[202]=4106,[203]=131085,[204]=266,[205]=4106,[206]=82193,
  [207]=8202,[209]=266,[210]=1034,[211]=2057,[212]=266,[213]=1034,[215]=32769,
  [217]=4106,[218]=513,[220]=16394,[224]=32770,[225]=266,[226]=522,[227]=522,
  [228]=4106,[229]=266,[231]=265,[232]=8194,[233]=8194,[234]=32770,
  [235]=32770,[236]=2062,[237]=258,[238]=65538,[239]=522,[240]=273,
  [241]=131082,[242]=8206,[243]=32790,[244]=4108,[245]=8202,[246]=266,
  [247]=2058,[248]=8202,[249]=4113,[250]=8215,[251]=273,[253]=266,[254]=9482,
  [255]=2071,[256]=4120,[258]=2060,[259]=131073,[260]=8207,[261]=513,
  [262]=1025,[264]=8209,[265]=2073,[266]=8209,[267]=266,[268]=524,[270]=16401,
  [271]=49414,[272]=18453,[277]=65537,[278]=16394,[279]=8202,[285]=32792,
  [286]=4104,[287]=262,[289]=2074,[291]=131093,[292]=266,[293]=16394,
  [294]=8202,[296]=266,[297]=539,[298]=266,[301]=65538,[302]=4113,[303]=1026,
  [306]=65538,[307]=266,[308]=266,[309]=8195,[310]=8202,[311]=265,[316]=257,
  [317]=273,[318]=270,[319]=32771,[320]=4097,[321]=2058,[323]=8202,
  [325]=42007,[328]=522,[329]=8202,[330]=32778,[333]=65546,[335]=131093,
  [337]=131082,[338]=4097,[339]=131082,[340]=266,[341]=266,[342]=266,
  [343]=8450,[346]=266,[347]=284,[348]=8209,[374]=258058,[378]=218381,
  [379]=230662,[380]=131338,[381]=16394,[382]=285,[383]=73734,[385]=206086,
  [386]=66822,[387]=1299,[388]=6409,[389]=261889,[391]=17677,[392]=83206,
  [393]=220171,[395]=6409,[396]=73730,[397]=213258,[398]=83206,[399]=9491,
  [400]=82690,[401]=6409,[402]=147721,[403]=42259,[404]=131334,[405]=4883,
  [406]=22785,[407]=75010,[408]=66835,[409]=42014,[410]=83206,[411]=778,
  [412]=66818,[414]=8458,[415]=22542,[416]=9482,[417]=83206,[418]=65811,
  [419]=65793,[420]=135425,[421]=147727,[422]=9486,[423]=18705,[424]=220171,
  [425]=41235,[427]=16642,[428]=75010,[429]=23054,[430]=1039,[431]=24595,
  [432]=8458,[433]=5395,[437]=33034,[438]=18451,[439]=18441,[440]=8970,
  [441]=21517,[442]=153631,[443]=218378,[445]=55306,[446]=19209,[447]=214278,
  [448]=218381,[449]=66826,[450]=2312,[452]=230666,[453]=6152,[454]=83206,
  [455]=45066,[456]=14607,[457]=18440,[458]=2321,[459]=75010,[460]=18702,
  [461]=264,[463]=18454,[464]=17674,[465]=8962,[466]=5395,[467]=22798,
  [468]=22798,[469]=23298,[470]=70402,[471]=60673,[472]=114433,[473]=16661,
  [474]=1056,[475]=131339,[477]=65797,[478]=213257,[479]=65825,[480]=18703,
  [482]=1299,[483]=131329,[484]=75010,[485]=22549,[487]=234762,[488]=131091,
  [489]=41487,[491]=9220,[492]=18703,[493]=6426,[494]=6410,[495]=131329,
  [496]=147738,[497]=153611,[498]=24841,[499]=4102,[500]=47882,[502]=131329,
  [503]=66821,[504]=33551,[505]=70931,[506]=84226,[507]=147726,[508]=4874,
  [509]=22538,[511]=66835,[512]=150030,[513]=261898,[514]=261898,[515]=261898,
  [517]=8458,[518]=2338,[519]=22537,[521]=32772,[523]=18440,[525]=132362,
  [528]=147475,[529]=4618,[530]=22794,[532]=2572,[534]=42766,[535]=16650,
  [536]=20489,[537]=6921,[538]=10257,[539]=230662,[540]=230662,[541]=23563,
  [542]=131329,[543]=17678,[544]=197649,[545]=9482,[546]=149518,[547]=120077,
  [548]=261902,[549]=230666,[550]=230662,[552]=72462,[553]=230662,[554]=20750,
  [555]=23563,[556]=149518,[557]=103950,[558]=8202,[559]=23063,[560]=34049,
  [562]=9491,[564]=133411,[565]=131329,[566]=147717,[567]=33811,[568]=16666,
  [569]=131329,[570]=33034,[571]=1299,[572]=2569,[573]=99591,[626]=112147,
  [627]=36881,[628]=33033,[629]=4873,[630]=42253,[631]=20499,[632]=33043,
  [633]=151818,[634]=16642,[635]=41235,[637]=66826,[638]=23563,[639]=230662,
  [640]=218381,[641]=218381,[644]=230662,[645]=24842,[646]=197898,
  [647]=107786,[648]=137493,[649]=12565,[650]=8201,[652]=65546,[665]=65550,
  [666]=4108,[671]=8202,[675]=230662,[677]=9482,[678]=18442,[679]=66570,
  [680]=66570,[699]=213250,[702]=132353,[703]=65802,[706]=9482,[707]=1290,
  [708]=230662,[709]=197894,[710]=82186,[711]=66826,[712]=66826,[713]=16661,
  [714]=99074,[716]=20482,[717]=150542,[718]=24842,[722]=180494,[723]=18709,
  [724]=33802,[725]=65802,[726]=5378,[727]=206090,[728]=197898,[729]=218381,
  [730]=214285,[731]=20482,[732]=24591,[733]=66826,[737]=9252,[739]=9246,
  [740]=246022,[741]=131338,[742]=1290,[743]=132378,[744]=220171,[745]=16650,
  [746]=2572,[747]=180494,[748]=259343,[749]=66570,[750]=66826,[751]=213254,
  [752]=131861,[753]=16654,[754]=226570,[755]=40991,[756]=17675,[757]=1033,
  [758]=8206,[792]=131343,[802]=529,[817]=4105,[818]=8207,[819]=1038,
  [820]=131082,[821]=65546,[823]=148746,[834]=4105,[835]=1034,[836]=1044,
  [837]=261897,[838]=261898,[844]=1039,[845]=41226,[846]=1056,[847]=131082,
  [848]=17677,[851]=5395,[855]=270,[856]=147466,[868]=16394,[903]=32791,
  [1013]=18709,[1039]=2053,[1040]=2058,[1042]=8229,[1061]=1034,[1062]=180486,
  [1063]=8209,[1068]=42253,[1073]=131082,[1117]=294,[1124]=8202,[1125]=266,
  [1126]=4106,[1127]=8206,[1128]=131338,[1142]=65537,[1143]=8202,[1144]=16394,
  [1145]=1034,[1146]=4106,[1147]=522,[1149]=8202,[1150]=16394,[1151]=4106,
  [1152]=2062,[1153]=522,[1154]=16394,[1155]=2063,[1156]=8202,[1157]=131338,
  [1158]=131082,[1159]=131086,[1160]=8201,[1161]=41487,[1162]=9220,
  [1163]=6152,[1164]=66835,[1165]=41487,[1166]=41487,[1167]=41487,
  [1168]=131082,[1174]=131086,[1175]=131338,[1176]=266,[1177]=55304,
  [1178]=522,[1179]=271,[1180]=42498,[1181]=18451,[1182]=131329,[1183]=522,
  [1184]=551,[1185]=16394,[1196]=16394,[1197]=4106,[1198]=8202,[1200]=8231,
  [1201]=32770,[1202]=33030,[1204]=65537,[1205]=55591,[1206]=32787,
  [1207]=131110,[1208]=65555,[1209]=275,[1211]=42498,[1212]=42498,
  [1213]=42498,[1226]=42766,[1227]=22537,[1228]=10792,[1229]=42025,
  [1230]=22570,[1231]=229642,[1232]=164139,[1233]=14892,[1234]=22823,
  [1235]=197642,[1236]=8230,[1237]=8232,[1238]=2321,[1243]=8202,[1244]=4106,
  [1245]=18698,[1248]=295,[1255]=4106,[1256]=98314,[1266]=552,[1276]=9738,
  [1303]=8234,[1304]=8194,[1305]=8201,[1320]=1034,[1321]=46607,[1322]=6673,
  [1323]=100134,[1324]=90378,[1325]=24842,[1326]=24842,[1328]=153866,
  [1329]=91146,[1330]=12051,[1331]=41482,[1332]=3594,[1333]=25885,
  [1334]=22547,[1335]=8202,[1336]=153866,[1337]=2583,[1338]=135425,
  [1343]=30218,[1344]=4135,[1345]=18442,[1346]=16394,[1348]=8202,[1349]=555,
  [1351]=4106,[1363]=8202,[1364]=557,[1365]=16394,[1384]=4124,[1385]=42762,
  [1386]=558,[1387]=47631,[1394]=2057,[1395]=2058,[1396]=8201,[1403]=103946,
  [1411]=32778,[1412]=3594,[1416]=4106,[1426]=2095,[1427]=147248,[1428]=4106,
  [1429]=261898,[1430]=261898,[1432]=261898,[1434]=261898,[1435]=2338,
  [1441]=131329,[1442]=2058,[1446]=32778,[1447]=14858,[1448]=229642,
  [1449]=522,[1450]=8202,[1451]=1034,[1453]=16394,[1454]=266,[1455]=229642,
  [1456]=229642,[1457]=229642,[1458]=229642,[1462]=229642,[1463]=229642,
  [1464]=229642,[1465]=229642,[1466]=65546,[1467]=1546,[1468]=168753,
  [1469]=168753,[1470]=168753,[1471]=32778,[1478]=4106,[1495]=100146,
  [1511]=1034,[1515]=8202,[1516]=32778,[1517]=527,[1518]=527,[1521]=8202,
  [1523]=1034,[1524]=20490,[1530]=522,[1531]=4107,[1532]=8215,[1533]=8204,
  [1536]=266,[1537]=2058,[1538]=1034,[1539]=522,[1540]=8202,[1541]=32778,
  [1542]=8202,[1543]=4104,[1544]=32778,[1545]=229642,[1546]=32778,
  [1563]=22026,[1564]=4106,[1565]=103946,[1566]=1034,[1567]=8206,[1568]=8202,
  [1569]=4147,[1570]=8215,[1571]=22794,[1572]=50954,[1573]=50954,[1574]=8244,
  [1575]=32772,[1576]=565,[1577]=229642,[1578]=2583,[1579]=2583,[1581]=2583,
  [1582]=2583,[1583]=2583,[1586]=24842,[1587]=24842,[1588]=24842,[1589]=24842,
  [1590]=180486,[1591]=180486,[1592]=180486,[1593]=180486,[1594]=22794,
  [1595]=22794,[1596]=8215,[1597]=8215,[1598]=18709,[1599]=18709,[1600]=11572,
  [1601]=565,[1602]=8245,[1603]=16414,[1605]=4123,[1615]=5395,[1622]=2057,
  [1623]=167946,[1624]=522,[1625]=4106,[1626]=131082,[1627]=16394,
  [1628]=229642,[1629]=229386,[1631]=1034,[1632]=22538,[1633]=32778,
  [1634]=266,[1636]=4106,[1639]=4138,[1655]=202506,[1656]=261898,[1660]=1038,
  [1661]=8242,[1662]=514,[1663]=6153,[1664]=270,[1665]=16438,[1672]=2103,
  [1687]=285,[1688]=14890,[1690]=8248,[1691]=8202,[1692]=32778,[1693]=522,
  [1699]=131081,[1700]=32782,[1701]=65542,[1705]=4105,[1706]=2057,
  [1708]=229649,[1709]=42767,[1710]=42771,[1711]=32810,[1712]=42762,
  [1713]=42761,[1714]=8202,[1715]=8207,[1716]=522,[1717]=32769,[1718]=531,
  [1719]=4134,[1720]=8198,[1721]=8207,[1722]=41487,[1723]=4111,[1725]=41516,
  [1726]=75010,[1727]=65538,[1728]=59415,[1729]=218381,[1730]=123914,
  [1731]=75010,[1734]=254214,[1735]=18449,[1736]=75027,[1737]=13066,
  [1738]=9482,[1739]=213254,[1740]=42250,[1741]=245770,[1743]=65842,
  [1744]=65802,[1749]=110355,[1750]=2321,[1752]=8215,[1753]=8221,[1754]=16413,
  [1755]=131101,[1756]=131081,[1759]=8201,[1760]=8207,[1761]=90385,
  [1762]=152079,[1763]=135433,[1764]=1081,[1765]=2105,[1766]=569,[1773]=16441,
  [1774]=8249,[1775]=107534,[1776]=135450,[1777]=298,[1778]=74765,
  [1802]=131082,[1803]=16394,[1804]=258,[1805]=2054,[1806]=16394,[1807]=32770,
  [1808]=131074,[1809]=207106,[1810]=4354,[1828]=4139,[1884]=4106,
  [1885]=131091,[1886]=2063,[1887]=32778,[1888]=4106,[1889]=65546,[1890]=1034,
  [1903]=2106,[1907]=8207,[1911]=266,[1912]=4117,[1913]=116490,[1914]=107530,
  [1915]=147210,[1917]=783,[1918]=131082,[1919]=131082,[1920]=32785,
  [1921]=571,[1922]=8233,[1926]=16408,[1927]=8207,[1928]=32783,[1929]=266,
  [1930]=131082,[1931]=8206,[1932]=4110,[1933]=65546,[1934]=4105,[1935]=306,
  [1936]=8235,[1938]=4136,[1939]=8232,[1940]=8231,[1941]=531,[1943]=1030,
  [1949]=32778,[1952]=266,[1953]=83004,[1954]=73738,[1955]=516,[1956]=133129,
  [1957]=264,[1958]=37642,[1959]=2109,[1960]=266,[1961]=137278,[1962]=8202,
  [1963]=266,[1964]=196362,[1965]=20778,[1966]=65546,[1967]=299,[1968]=74815,
  [1969]=1066,[1974]=1034,[1975]=4106,[1976]=522,[1977]=8202,[1984]=153619,
  [1997]=561,[1998]=2058,[1999]=91146,[2000]=45066,[2001]=135488,[2002]=2073,
  [2003]=2057,[2004]=4105,[2017]=527,[2018]=32778,[2022]=321,[2035]=4106,
  [2036]=32778,[2037]=8202,[2041]=4104,[2042]=8242,[2047]=1064,[2049]=131080,
  [2050]=1034,[2051]=65602,[2057]=74771,[2058]=102409,[2062]=8211,
  [2063]=132627,[2064]=8251,[2065]=1802,[2071]=4106,[2072]=266,[2076]=67,
  [2077]=8194,[2078]=2056,[2079]=135210,[2080]=299,[2081]=106506,[2082]=66579,
  [2083]=156200,[2084]=8230,[2085]=1062,[2086]=98822,[2087]=8202,[2088]=17413,
  [2089]=229386,[2090]=172585,[2091]=8201,[2092]=4105,[2093]=521,[2113]=8235,
  [2114]=32810,[2115]=131087,[2116]=16403,[2117]=526,[2118]=2057,[2119]=521,
  [2120]=1039,[2121]=520,[2122]=45064,[2123]=153608,[2124]=80650,
  [2126]=251146,[2127]=16393,[2128]=8458,[2129]=8458,[2130]=113977,
  [2131]=101691,[2132]=103207,[2133]=234771,[2134]=254217,[2135]=41486,
  [2143]=16394,[2157]=271,[2158]=65593,[2163]=4137,[2165]=4115,[2184]=16394,
  [2185]=1034,[2186]=8202,[2187]=2058,[2188]=8202,[2189]=8202,[2190]=1034,
  [2192]=266,[2196]=8202,[2197]=4106,[2198]=65546,[2199]=522,[2201]=266,
  [2202]=4106,[2352]=298,[2372]=261898,[2373]=258826,[2374]=165642,
  [2375]=203530,[2376]=184102,[2377]=102212,[2378]=131382,[2379]=195385,
  [2380]=193286,[2381]=133130,[2382]=15146,[2383]=80138,[2384]=99909,
  [2385]=91146,[2386]=133446,[2387]=86827,[2388]=91199,[2389]=193546,
  [2390]=148807,[2392]=89416,[2393]=153621,[2394]=229702,[2395]=45641,
  [2397]=223047,[2398]=1098,[2399]=1099,[2400]=50442,[2401]=4135,
  [2402]=131126,[2403]=332,[2404]=65546,[2405]=65576,[2406]=266,[2407]=32806,
  [2408]=131082,[2409]=327,[2410]=4139,[2411]=16461,[2412]=4105,[2413]=32841,
  [2414]=8270,[2415]=1034,[2416]=277,[2417]=568,[2418]=8263,[2419]=65546,
  [2420]=32844,[2421]=32778,[2422]=1062,[2423]=4175,[2424]=266,[2425]=131142,
  [2426]=1095,[2427]=4175,[2428]=592,[2429]=2069,[2430]=8249,[2431]=8198,
  [2432]=84226,[2433]=1034,[2434]=22823,[2435]=275,[2436]=6152,[2437]=17674,
  [2438]=66831,[2439]=32797,[2440]=22826,[2441]=1290,[2442]=8202,[2443]=6417,
  [2444]=6417,[2445]=4158,[2446]=131153,[2447]=65546,[2448]=16466,[2449]=4175,
  [2450]=8275,[2451]=1034,[2452]=4180,[2453]=131157,[2454]=598,[2455]=32855,
  [2456]=65624,[2457]=8281,[2458]=2138,[2459]=2138,[2460]=1115,[2461]=65628,
  [2462]=1111,[2463]=16477,[2464]=592,[2465]=4176,[2466]=578,[2467]=1118,
  [2468]=2143,[2469]=16453,[2471]=1120,[2472]=2118,[2473]=609,[2474]=2058,
  [2475]=1034,[2476]=8202,[2477]=266,[2478]=32858,[2479]=32858,[2525]=1062,
  [2526]=2107,[2527]=8272,[2528]=4162,[2529]=354,[2530]=8291,[2531]=16484,
  [2532]=599,[2533]=2149,[2534]=606,[2535]=4198,[2537]=34610,[2538]=16477,
  [2539]=1066,[2540]=359,[2544]=8293,[2545]=522,[2546]=65585,[2547]=4197,
  [2548]=2152,[2549]=600,[2550]=16453,[2551]=4124,[2552]=65641,[2553]=1034,
  [2554]=4714,[2555]=32871,[2556]=65550,[2557]=4203,[2558]=520,[2559]=1132,
  [2560]=8281,[2561]=16493,[2562]=3688,[2563]=4184,[2564]=8262,[2565]=1098,
  [2566]=333,[2567]=8302,[2568]=8193,[2569]=2159,[2575]=8268,[2576]=131127,
  [2577]=1136,[2578]=65649,[2579]=2121,[2580]=626,[2581]=65649,[2582]=131187,
  [2583]=8215,[2584]=65586,[2585]=514,[2586]=2122,[2587]=2164,[2589]=65560,
  [2590]=32885,[2591]=630,[2621]=4140,[2623]=32834,[2638]=2167,[2645]=45432,
  [2646]=45177,[2647]=151930,[2648]=74875,[2649]=8828,[2650]=229757,
  [2651]=74878,[2652]=639,[2653]=153984,[2657]=4218,[2658]=12417,
  [2659]=131458,[2660]=135555,[2661]=229764,[2662]=16481,[2663]=219269,
  [2664]=6152,[2665]=91177,[2666]=4135,[2667]=258182,[2668]=66951,
  [2669]=213384,[2670]=230537,[2671]=1038,[2672]=233610,[2673]=236939,
  [2674]=396,[2675]=83341,[2676]=196985,[2677]=45198,[2678]=124559,
  [2680]=131113,[2681]=32912,[2682]=401,[2683]=65599,[2684]=153746,
  [2685]=229779,[2686]=2138,[2687]=4244,[2688]=4224,[2689]=8341,[2690]=8342,
  [2691]=663,[2692]=1176,[2693]=16537,[2694]=124509,[2695]=45722,[2696]=65617,
  [2697]=411,[2698]=131228,[2699]=32925,[2700]=16542,[2701]=4255,[2702]=8344,
  [2703]=16544,[2704]=147617,[2706]=2210,[2707]=4259,[2708]=676,[2709]=33939,
  [2710]=8357,[2711]=8358,[2712]=1191,[2713]=131240,[2714]=425,[2715]=65585,
  [2716]=32810,[2717]=4266,[2718]=2219,[2719]=16556,[2720]=1197,[2721]=32877,
  [2747]=4214,[2748]=4270,[2749]=687,[2750]=8368,[2753]=2097,[2754]=8369,
  [2755]=4274,[2756]=691,[2757]=153773,[2758]=34740,[2760]=34740,[2761]=3897,
  [2762]=45237,[2763]=10140,[2765]=229738,[2766]=2230,[2767]=8375,
  [2776]=65720,[2777]=569,[2778]=2138,[2779]=16569,[2792]=34490,[2793]=1902,
  [2794]=9403,[2795]=8380,[2796]=299,[2797]=8235,[2798]=9,[2832]=8381,
  [2833]=2238,[2834]=4287,[2835]=8384,[2836]=8385,[2837]=705,[2838]=1218,
  [2839]=8387,[2840]=708,[2841]=522,[2842]=709,[2843]=271,[2844]=271,
  [2845]=8390,[2846]=711,[2847]=711,[2848]=4296,[2849]=2102,[2850]=8389,
  [2851]=8393,[2852]=2250,[2853]=8309,[2863]=143051,[2864]=133580,
  [2865]=12917,[2866]=91253,[2867]=3789,[2868]=1142,[2869]=718,[2870]=8397,
  [2872]=1034,[2878]=10,[2889]=10,[2891]=10,[2892]=10,[2893]=10,[2894]=10,
  [2895]=10,[2896]=10,[2897]=10,[2898]=10,[2899]=10,[2900]=10,[2901]=10,
  [2902]=10,[2903]=10,[2904]=10,[2905]=10,[2907]=10,[2908]=10,[2909]=10,
  [2910]=10,[2911]=10,[2912]=10,[2913]=10,[2914]=10,[2915]=10,[2916]=10,
  [2917]=10,[2918]=10,[2919]=10,[2920]=10,[2921]=10,[2922]=10,[2923]=10,
  [2924]=10,[2925]=10,[2926]=10,[2927]=10,[2928]=10,[2929]=10,[2930]=10,
  [2931]=10,[2932]=10,[2933]=10,[2934]=10,[2935]=10,[2936]=10,[2937]=10,
  [2938]=10,[2939]=10,[2940]=10,[2941]=10,[2942]=10,[2943]=10,[2944]=10,
  [2945]=10,[2946]=10,[2947]=10,[2948]=10,[2949]=10,[2950]=10,[2952]=10,
  [2953]=10,[2954]=10,[2955]=10,[2956]=10,[2957]=10,[2958]=10,[2959]=10,
  [2960]=10,[2961]=10,[2962]=10,[2963]=10,[2964]=10,[2965]=10,[2966]=10,
  [2967]=10,[3006]=10,[3007]=10,[3008]=10,[3009]=10,[3011]=10,[3012]=10,
  [3013]=10,[3014]=10,[3015]=10,[3016]=10,[3017]=10,[3018]=10,[3019]=10,
  [3020]=10,[3021]=10,[3022]=10,[3023]=10,[3024]=10,[3025]=10,[3026]=10,
  [3027]=10,[3028]=10,[3029]=10,[3030]=10,[3032]=10,[3033]=10,[3034]=10,
  [3035]=10,[3036]=10,[3037]=10,[3038]=10,[3039]=10,[3040]=10,[3041]=10,
  [3042]=10,[3043]=10,[3044]=10,[3045]=10,[3046]=10,[3047]=10,[3049]=10,
  [3050]=10,[3051]=10,[3052]=10,[3054]=10,[3061]=10,[3062]=10,[3063]=10,
  [3064]=10,[3065]=10,[3066]=10,[3067]=10,[3079]=10,[3080]=10,[3081]=10,
  [3082]=10,[3083]=10,
};

-------------------------------------------------------------------------------
--                 A  D  D  O  N     V  A  R  I  A  B  L  E  S
-------------------------------------------------------------------------------

L.petSpeciesMaxId  = table.maxn(speciesInfo);
L.petSpeciesRanges =
{
  {824,               833}, -- Species using standard pet family icons
  {  1,               823},
  {834, L.petSpeciesMaxId}
};

-------------------------------------------------------------------------------
--                 L  O  C  A  L     F  U  N  C  T  I  O  N  S
-------------------------------------------------------------------------------

-------------------------------------------------------------------------------
--                 A  D  D  O  N     F  U  N  C  T  I  O  N  S
-------------------------------------------------------------------------------

function L.petGetBreed(petGuid)
  -- Local Variables
  local _;
  local baseStat;
  local breedsHealth = 0;
  local breedsPower = 0;
  local breedsSpeed = 0;
  local petBreed;
  local petHealth;
  local petLevel;
  local petMultiplier;
  local petPower;
  local petQuality;
  local petSpeciesId;
  local petSpeed;
  local petStatProfile;

  -- Get the pet's species and level
  petSpeciesId, _, petLevel = cpjGetPetInfoByPetID(petGuid);
  if ((petSpeciesId ~= nil) and (speciesInfo[petSpeciesId] ~= nil)) then
    -- Get the pet's stats
    _, petHealth, petPower, petSpeed, petQuality = cpjGetPetStats(petGuid);
    if (petPower ~= nil) then
      -- Work out the multiplier for the pet's quality and level
      petMultiplier  = (1+((petQuality-1)/10))*petLevel;
      petStatProfile = baseStatProfiles[speciesInfo[petSpeciesId]%256];

      -- Work out the possible breeds the pet could be, based on its power
      baseStat  = petStatProfile[2];
      breedMask = 0;
      if (floor((baseStat*petMultiplier)+0.4999) == petPower) then
        breedMask = breedMask+0x00004C00;
      end
      if (floor(((baseStat+0.4)*petMultiplier)+0.4999) == petPower) then
        breedMask = breedMask+0x00030000;
      end
      if (floor(((baseStat+0.5)*petMultiplier)+0.4999) == petPower) then
        breedMask = breedMask+0x00000100;
      end
      if (floor(((baseStat+0.9)*petMultiplier)+0.4999) == petPower) then
        breedMask = breedMask+0x0000B000;
      end
      if (floor(((baseStat+2.0)*petMultiplier)+0.4999) == petPower) then
        breedMask = breedMask+0x00000200;
      end
      petBreed = breedMask;

      -- Work out the possible breeds the pet could be, based on its speed
      baseStat  = petStatProfile[3];
      breedMask = 0;
      if (floor((baseStat*petMultiplier)+0.4999) == petSpeed) then
        breedMask = breedMask+0x00001A00;
      end
      if (floor(((baseStat+0.4)*petMultiplier)+0.4999) == petSpeed) then
        breedMask = breedMask+0x00028000;
      end
      if (floor(((baseStat+0.5)*petMultiplier)+0.4999) == petSpeed) then
        breedMask = breedMask+0x00000100;
      end
      if (floor(((baseStat+0.9)*petMultiplier)+0.4999) == petSpeed) then
        breedMask = breedMask+0x00016000;
      end
      if (floor(((baseStat+2.0)*petMultiplier)+0.4999) == petSpeed) then
        breedMask = breedMask+0x00000400;
      end
      petBreed = bitAnd(petBreed, breedMask);

      -- Adjust some variables to make the Health calculations simpler
      petHealth     = petHealth-100;
      petMultiplier = petMultiplier*5;
     
      -- Work out the possible breeds the pet could be, based on its health
      baseStat  = petStatProfile[1];
      breedMask = 0;
      if (floor((baseStat*petMultiplier)+0.4999) == petHealth) then
        breedMask = breedMask+0x00002600;
      end
      if (floor(((baseStat+0.4)*petMultiplier)+0.4999) == petHealth) then
        breedMask = breedMask+0x00018000;
      end
      if (floor(((baseStat+0.5)*petMultiplier)+0.4999) == petHealth) then
        breedMask = breedMask+0x00000100;
      end
      if (floor(((baseStat+0.9)*petMultiplier)+0.4999) == petHealth) then
        breedMask = breedMask+0x00025000;
      end
      if (floor(((baseStat+2.0)*petMultiplier)+0.4999) == petHealth) then
        breedMask = breedMask+0x00000800;
      end
      petBreed = bitAnd(petBreed, breedMask);
    end

    -- Apply the available breeds bit mask for the pet's species, if known
    if (bitAnd(speciesInfo[petSpeciesId], 0xFFFFFF00) > 0) then
      petBreed = bitAnd(petBreed, speciesInfo[petSpeciesId]);
    end
  end

  return (petBreeds[petBreed] or "(?/?)");
end
